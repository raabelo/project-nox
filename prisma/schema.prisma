generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum Role {
  PLAYER_CHARACTER
  DUNGEON_MASTER
}

enum LoreObjectType {
  LOCATION
  ITEM
  NPC
  EVENT
  PLAYER_CHARACTER
}

model User {
  id String @id @default(cuid())

  email    String @unique
  password String
  nickname String @unique

  characters PlayerCharacter[]

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
}

model Game {
  id String @id @default(cuid())

  title       String
  description String?
  background  String?
  // sortTermSummary String?
  // longTermSummary String?

  characters  PlayerCharacter[]
  memories    Memory[]
  loreObjects LoreObject[]
  dialogues   DialogueMessage[]

  summaryUpdatedAt DateTime @default(now())

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
}

model PlayerCharacter {
  id String @id @default(cuid())

  name    String
  uiColor String?

  user   User   @relation(fields: [userId], references: [id])
  userId String
  game   Game   @relation(fields: [gameId], references: [id])
  gameId String

  memories  Memory[]
  dialogues DialogueMessage[]

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
}

model Memory {
  id String @id @default(cuid())

  name      String
  content   String
  embedding String?

  game   Game   @relation(fields: [gameId], references: [id])
  gameId String

  characters  PlayerCharacter[]
  loreObjects LoreObject[]

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
}

model LoreObject {
  id String @id @default(cuid())

  type        LoreObjectType
  name        String
  description String?

  game   Game   @relation(fields: [gameId], references: [id])
  gameId String

  memories Memory[]

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
}

model DialogueMessage {
  id String @id @default(cuid())

  message   String
  role      Role
  embedding String?

  character   PlayerCharacter? @relation(fields: [characterId], references: [id])
  characterId String?
  game        Game             @relation(fields: [gameId], references: [id])
  gameId      String

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
}

// model Addon {
//   id String @id @default(cuid())

//   name        String
//   slug        String  @unique
//   version     String
//   author      String?
//   description String?
//   repository  String?
//   enabled     Boolean @default(false)

//   createdAt DateTime  @default(now())
//   updatedAt DateTime? @updatedAt
// }
